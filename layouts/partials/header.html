<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" prefix="og: http://ogp.me/ns#">
{{ partial "head.html" . }}
<body>
  <a href="#main" class="skip-link p-screen-reader-text">{{ i18n "skip-to-content" }}</a>
  {{ partial "svgpack-sprite.html" . }}
  <header class="l-header">
    {{ if .IsPage }}
    <p class="c-title p-title"><a href="{{ .Site.BaseURL }}" class="p-title__link">{{ .Site.Title }}</a></p>
    {{ else }}
    <h1 class="c-title p-title"><a href="{{ .Site.BaseURL }}" class="p-title__link">{{ .Site.Title }}</a></h1>
    {{ end }}
    {{ with ($.Param "subtitle") }}
    <p class="p-subtitle">
      {{ . }}
    </p>
    {{ end }}

    <div class="l-nav-wrapper">
      <button class="mobile-menu-toggle" aria-expanded="false" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
      {{- partial "menu.html" . -}}
      <button class="search-toggle" aria-label="Search" aria-expanded="false">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.35-4.35"></path>
        </svg>
      </button>
    </div>
  </header>
  {{- partial "header_custom.html" . }}

  <!-- Full-screen mobile menu overlay -->
  <div class="mobile-menu-overlay" id="mobile-menu-overlay" hidden>
    <div class="mobile-menu-header">
      <a href="{{ .Site.BaseURL }}" class="mobile-menu-logo">/dev/random</a>
      <button class="mobile-menu-close" aria-label="Close menu" id="mobile-menu-close">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div class="mobile-menu-content">
      {{- partial "menu.html" . -}}
      <div class="mobile-menu-search">
        {{- partial "search.html" . -}}
      </div>
    </div>
  </div>

  <!-- Search container -->
  <div class="search-container" id="search-container" hidden>
    {{- partial "search.html" . -}}
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    var toggle = document.querySelector('.mobile-menu-toggle');
    var navWrapper = document.querySelector('.l-nav-wrapper');
    var overlay = document.getElementById('mobile-menu-overlay');
    var closeBtn = document.getElementById('mobile-menu-close');
    var searchToggle = document.querySelector('.search-toggle');
    var searchContainer = document.getElementById('search-container');

    // Menu toggle
    if (toggle && overlay) {
      toggle.addEventListener('click', function() {
        var isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        if (isExpanded) {
          // Close menu
          toggle.setAttribute('aria-expanded', 'false');
          overlay.hidden = true;
          overlay.classList.remove('is-open');
        } else {
          // Open menu
          toggle.setAttribute('aria-expanded', 'true');
          overlay.hidden = false;
          // Small delay to allow display:flex to apply before opacity transition
          requestAnimationFrame(function() {
            overlay.classList.add('is-open');
          });
        }
      });
    }

    // Close button
    if (closeBtn && overlay && toggle) {
      closeBtn.addEventListener('click', function() {
        toggle.setAttribute('aria-expanded', 'false');
        overlay.classList.remove('is-open');
        setTimeout(function() {
          overlay.hidden = true;
        }, 300);
      });
    }

    // Close menu when clicking a link
    if (overlay) {
      var menuLinks = overlay.querySelectorAll('a');
      menuLinks.forEach(function(link) {
        link.addEventListener('click', function() {
          if (toggle && overlay) {
            toggle.setAttribute('aria-expanded', 'false');
            overlay.classList.remove('is-open');
            setTimeout(function() {
              overlay.hidden = true;
            }, 300);
          }
        });
      });
    }

    // Search toggle
    if (searchToggle && searchContainer) {
      searchToggle.addEventListener('click', function() {
        var isHidden = searchContainer.hidden;
        searchContainer.hidden = !isHidden;
        searchToggle.setAttribute('aria-expanded', isHidden);
        if (isHidden && searchContainer.querySelector('#search')) {
          var input = searchContainer.querySelector('.pagefind-ui__search-input');
          if (input) {
            setTimeout(function() { input.focus(); }, 100);
          }
        }
      });
    }
  });
  </script>
  <main id="main" class="l-main">
